{% extends 'base.html.twig' %}

{#{% block javascripts %}
<script type="text/javascript" src="bootstrap-datetimepicker.de.js" charset="UTF-8">
    $(document).ready(function() {
        $('#datetimepicker').datetimepicker({
            format: 'dd-mm-yyyy'
        });
    });
</script>
{% endblock %}#}


{% block Body %}
    {% if (is_granted('ROLE_ADMIN') or app.user.id == app.request.get("id")) %}
        {% if (is_granted('ROLE_ADMIN')) %}
            <a class="btn btn-success" href="{{ path('admin_show',{'id':userConnected.id}) }}" class="btn-btn-primary">
                Retour
            </a>
        {% else %}
            <a class="btn btn-success" href="{{ path('profile_show',{'id':userConnected.id}) }}"
               class="btn-btn-primary">
                Retour
            </a>
        {% endif %}

        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <h2>Edition du profil
                        {% if (app.user.id == app.request.get("id")) %}
                            <div class="col-4">
                                <button type="submit" class="btn btn-success">Modifier mot de passe</button>
                            </div>
                        {% endif %}
                    </h2>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <div class="user-avatar user-avatar-xl fileinput-button">
                                        <img src="{{ vich_uploader_asset(userConnected.user, 'imageFile') }}"
                                             alt="{{ userConnected.user.imageFile }}" name="avatar" width="150"/>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <h3>{{ userConnected.name }} {{ userConnected.firstName }} </h3>
                                        <div class="metadata">Inscrit sur le site depuis
                                            : {{ userConnected.createdUser |date('d/m/Y') }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <h3> Informations générales :</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <p> Nom d'utilisateur : {{ userConnected.username }} </p>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <p> Email : {{ userConnected.email }} </p>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <p> Date de naissance : {{ userConnected.birthday |date('d/m/Y') }} </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if (is_granted('ROLE_ADMIN')) %}
            {{ form_start(formUser) }}
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div class="col-md-10">
                        <h2> Modification des données personnelles </h2>
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            {{ form_widget(formUser.imageFile) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            {{ form_widget(formUser.sex) }}

                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            {{ form_label(formUser.belt, 'Grade') }}
                                            {{ form_widget(formUser.belt) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            {{ form_label(formUser.receiptDate, 'Date de réception') }}
                                            {{ form_widget(formUser.receiptDate) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-success">
                                                Enregister modification(s)
                                            </button>
                                            {{ form_end(formUser) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        {% endif %}

        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <h2>Coordonnées</h2>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <h3>Téléphones</h3>
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th>Type</th>
                                                <th>Numéro</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for phone in userConnected.user.phones %}
                                            <tr>
                                                <td>{{ phone.type }}</td>
                                                <td>{{ phone.num }}</td>
                                                <td>
                                                    {% if (is_granted('ROLE_ADMIN')) %}
                                                    <a class="btn btn-sm btn-icon btn-secondary"
                                                       href="{{ path('remove_phone_admin',{'idPhone':phone.id, 'idUser':userConnected.id}) }}">
                                                        <i class="fa fa-trash-o">
                                                        </i>
                                                        <span class="sr-only">Supprimer</span>
                                                    </a>
                                                    {% else %}
                                                    <a class="btn btn-sm btn-icon btn-secondary"
                                                       href="{{ path('remove_phone',{'idPhone':phone.id, 'idUser':userConnected.id}) }}">
                                                        <i class="fa fa-trash-o">
                                                        </i>
                                                        <span class="sr-only">Supprimer</span>
                                                    </a>
                                                </td>
                                            </tr>
                                            {% endif %}
                                            {% else %}
                                            <tr>
                                                <td colspan="10">Aucune numéro de téléphone
                                                </td>
                                            </tr>
                                            </tbody>
                                            {% endfor %}
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <h4>Nouveau numéro</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        {{ form_start(phoneForm) }}
                                        {{ form_label(phoneForm.type, 'Type') }}
                                        {{ form_widget(phoneForm.type,  {'attr':{
                                            'placeholder':"Domicile, travail..."
                                        }}) }}                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        {{ form_label(phoneForm.num, 'Numéro') }}
                                        {{ form_widget(phoneForm.num,  {'attr':{
                                            'placeholder':"Votre nouveau numéro..."
                                        }}) }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-success">Ajouter numéro</button>
                                        {{ form_end(phoneForm) }}
                                    </div>
                                </div>
                            </div>


                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <h3>Adresses</h3>
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th>Type</th>
                                                <th>Numéro</th>
                                                <th>Rue</th>
                                                <th>Ville</th>
                                                <th>Pays</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for adress in userConnected.user.adress %}
                                            <tr>
                                                <td>{{ adress.type }}</td>
                                                <td>{{ adress.num }}
                                                    {% if adress.postBox %}
                                                        ({{ adress.postBox }})
                                                    {% endif %}
                                                </td>
                                                <td>{{ adress.streetName }}</td>
                                                <td>{{ adress.city.cityName }}
                                                    {% if adress.city.zip %}
                                                        ({{ adress.city.zip }})
                                                    {% endif %}
                                                </td>
                                                <td>{{ adress.city.country.countryName }}</td>
                                                <td>
                                                    {% if (is_granted('ROLE_ADMIN')) %}
                                                    <a class="btn btn-sm btn-icon btn-secondary"
                                                       href="{{ path('remove_adress_admin',{'idAdress':adress.id, 'idUser':userConnected.id}) }}">
                                                        <i class="fa fa-trash-o">
                                                        </i>
                                                        <span class="sr-only">Supprimer</span>
                                                    </a>
                                                    {% else %}
                                                    <a class="btn btn-sm btn-icon btn-secondary"
                                                       href="{{ path('remove_adress',{'idAdress':adress.id, 'idUser':userConnected.id}) }}">
                                                        <i class="fa fa-trash-o">
                                                        </i>
                                                        <span class="sr-only">Supprimer</span>
                                                    </a>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% else %}
                                            <tr>
                                                <td colspan="10">Aucune adresse</td>
                                            </tr>
                                            </tbody>
                                            {% endfor %}
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        {#
                    <select name="Type">
                        <option value="Domicile">Domicile</option>
                        <option value="Portable">Portable</option>
                        <option value="Travaille">Travail</option>
                    </select>
        #}


        <h4>Nouvelle adresse</h4>
        <div class="phone">

            <div class="row">
                <div class="col-2">
                    {{ form_start(adressForm) }}
                    Type {{ form_widget(adressForm.type) }}
                </div>
                <div class="col-2">
                    Numero {{ form_widget(adressForm.num) }}
                </div>
                <div class="col-2">
                    BP {{ form_widget(adressForm.postBox) }}
                </div>
                <div class="col-11">
                    Rue {{ form_widget(adressForm.streetName) }}
                </div>
                <div class="col-2">
                    CP {{ (form_widget(cityForm.zip) ) }}
                </div>
                <div class="col-5">
                    Ville {{ form_widget(cityForm.cityName) }}
                </div>
                <div class="col-4">
                    Pays {{ form_widget(cityForm.country) }}
                </div>
                <div class="col-3">
                    <button type="submit" class="btn btn-success">Ajouter adresse</button>
                    {{ form_end(adressForm) }}
                </div>
            </div>
        </div>

        {#Affiche personnes de contact#}
        <h3>Personnes de contact</h3>
        {% for contactList in userConnected.user.contactLists %}
            {% if (is_granted('ROLE_ADMIN')) %}
                <form action="{{ path('remove_PoC_admin',{'idCL':contactList.id, 'idUser':userConnected.id}) }}" method="post">
            {% else %}
                <form action="{{ path('remove_PoC',{'idCL':contactList.id, 'idUser':userConnected.id}) }}" method="post">
            {% endif %}
            <div class="personOfContact">
                <div class="row">
                    <div class="col-2">
                        Nom: {{ contactList.personOfContact.name }}
                    </div>
                    <div class="col-2">
                        Prénom : {{ contactList.personOfContact.firstName }}
                    </div>
                    <div class="col-2">
                        Numéro : {{ contactList.personOfContact.num1 }}
                    </div>
                    <div class="col-2">
                        Relation : {{ contactList.relation }}
                    </div>
                    <div class="col-11">
                        Info : {{ contactList.info }}
                    </div>
                    <div class="col-3">
                        <div class="col">
                            <button type="submit" class="btn btn-link">Supprimer la personne de contact</button>
                        </div>
                    </div>
                    <div class="col-3">
                        {% if (is_granted('ROLE_ADMIN')) %}
                            <a href="{{ path('edit_PoC_admin',{'id':userConnected.id, 'idCL':contactList.id, 'idPoC':contactList.personOfContact.id}) }}">
                                Modifier personne de contact</a>
                        {% else %}
                            <a href="{{ path('edit_PoC',{'id':userConnected.id, 'idCL':contactList.id, 'idPoC':contactList.personOfContact.id}) }}">
                                Modifier personne de contact</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            </form>

        {% endfor %}

        <h4>Nouvelle personne de contact</h4>
        <div class="row">
            <div class="col-3">
                {{ form_start(PoCForm) }}
                Nom {{ form_widget(PoCForm.name) }}
            </div>
            <div class="col-3">
                Prénom {{ form_widget(PoCForm.firstName) }}
            </div>
            <div class="col-3">
                Numéro {{ form_widget(PoCForm.num1) }}
            </div>
            <div class="col-2">
                Relation {{ (form_widget(ContactListForm.relation) ) }}
            </div>
            <div class="col-11">
                Info {{ (form_widget(ContactListForm.info) ) }}
            </div>
            <div class="col-3">
                <button type="submit" class="btn btn-success">Ajouter une nouvelle personne de contact</button>
                {{ form_end(PoCForm) }}
            </div>
        </div>

    {% else %}
        <h2> Vous n'êtes pas autorisé à accéder à cette page </h2>
    {% endif %}

{% endblock %}